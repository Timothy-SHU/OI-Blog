<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/OI-Blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/OI-Blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/OI-Blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/OI-Blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/OI-Blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timothy-shu.github.io","root":"/OI-Blog/","images":"/OI-Blog/images","scheme":"Gemini","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/OI-Blog/js/config.js"></script>

    <meta name="description" content="ProblemRoadside Trees$\mathrm{Time;limit:;5;Sec}$$\mathrm{Memory;limit:;256;MB}$ DescriptionSquirrel Liss loves nuts. Liss asks you to plant some nut trees.There are $n$ positions (numbered 1 to $n$ f">
<meta property="og:type" content="article">
<meta property="og:title" content="CF264E Roadside Trees &lt;线段树&gt;">
<meta property="og:url" content="https://timothy-shu.github.io/OI-Blog/2018/10/01/CF264E%20Roadside%20Trees%20%E7%BA%BF%E6%AE%B5%E6%A0%91/index.html">
<meta property="og:site_name" content="NIRVANA">
<meta property="og:description" content="ProblemRoadside Trees$\mathrm{Time;limit:;5;Sec}$$\mathrm{Memory;limit:;256;MB}$ DescriptionSquirrel Liss loves nuts. Liss asks you to plant some nut trees.There are $n$ positions (numbered 1 to $n$ f">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-09-30T16:00:00.000Z">
<meta property="article:modified_time" content="2018-10-08T12:51:52.696Z">
<meta property="article:author" content="Azrael">
<meta property="article:tag" content="线段树">
<meta property="article:tag" content="数据结构">
<meta property="article:tag" content="CodeForces">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://timothy-shu.github.io/OI-Blog/2018/10/01/CF264E%20Roadside%20Trees%20%E7%BA%BF%E6%AE%B5%E6%A0%91/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://timothy-shu.github.io/OI-Blog/2018/10/01/CF264E%20Roadside%20Trees%20%E7%BA%BF%E6%AE%B5%E6%A0%91/","path":"2018/10/01/CF264E Roadside Trees 线段树/","title":"CF264E Roadside Trees \u003c线段树>"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CF264E Roadside Trees <线段树> | NIRVANA</title>
  






  <noscript>
    <link rel="stylesheet" href="/OI-Blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/OI-Blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">NIRVANA</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">OI Journal</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/OI-Blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="https://timothy-shu.github.io/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/OI-Blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/OI-Blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Problem"><span class="nav-number">1.</span> <span class="nav-text">Problem</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Roadside-Trees"><span class="nav-number">1.1.</span> <span class="nav-text">Roadside Trees</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Description"><span class="nav-number">1.2.</span> <span class="nav-text">Description</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input"><span class="nav-number">1.3.</span> <span class="nav-text">Input</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Output"><span class="nav-number">1.4.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example"><span class="nav-number">1.5.</span> <span class="nav-text">Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Translation"><span class="nav-number">2.</span> <span class="nav-text">Translation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solution"><span class="nav-number">3.</span> <span class="nav-text">Solution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code"><span class="nav-number">4.</span> <span class="nav-text">Code</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Azrael</p>
  <div class="site-description" itemprop="description">Former OIer</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/OI-Blog/archives/">
          <span class="site-state-item-count">248</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/OI-Blog/tags/">
        <span class="site-state-item-count">152</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://timothy-shu.github.io/OI-Blog/2018/10/01/CF264E%20Roadside%20Trees%20%E7%BA%BF%E6%AE%B5%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/OI-Blog/images/avatar.gif">
      <meta itemprop="name" content="Azrael">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
      <meta itemprop="description" content="Former OIer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="CF264E Roadside Trees <线段树> | NIRVANA">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CF264E Roadside Trees <线段树>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-10-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-10-01T00:00:00+08:00">2018-10-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><h3 id="Roadside-Trees"><a href="#Roadside-Trees" class="headerlink" title="Roadside Trees"></a>Roadside Trees</h3><p>$\mathrm{Time;limit:;5;Sec}$<br>$\mathrm{Memory;limit:;256;MB}$</p>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Squirrel Liss loves nuts. Liss asks you to plant some nut trees.<br>There are $n$ positions (numbered 1 to $n$ from west to east) to plant a tree along a street. Trees grow one meter per month. At the beginning of each month you should process one query. The query is one of the following types:</p>
<ul>
<li>Plant a tree of height $h$ at position $p$.</li>
<li>Cut down the $x^{th}$ existent (not cut) tree from the west (where $x$ is 1-indexed). When we cut the tree it drops down and takes all the available place at the position where it has stood. So no tree can be planted at this position anymore.</li>
</ul>
<p>After processing each query, you should print the length of the longest increasing subsequence. A subset of existent trees is called an increasing subsequence if the height of the trees in the set is strictly increasing from west to east (for example, the westmost tree in the set must be the shortest in the set). The length of the increasing subsequence is the number of trees in it.<br>Note that Liss don’t like the trees with the same heights, so it is guaranteed that at any time no two trees have the exactly same heights.</p>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>The first line contains two integers: $n$ and $m$ $(1\le n\le 10^5; 1\le m\le 2\cdot 10^5)$ – the number of positions and the number of queries.<br>Next $m$ lines contains the information of queries by following formats:</p>
<ul>
<li>If the $i^{th}$ query is type 1, the $i^{th}$ line contains three integers: 1, $p_i$, and $h_i$ $(1\le p_i\le n,1\le h_i\le 10)$, where $p_i$ is the position of the new tree and $h_i$ is the initial height of the new tree.</li>
<li>If the $i^{th}$ query is type 2, the $i^{th}$ line contains two integers: 2 and $x_i$ $(1\le x_i\le 10)$, where the $x_i$ is the index of the tree we want to cut.<br>The input is guaranteed to be correct, i.e.,</li>
<li>For type 1 queries, $p_i$ will be pairwise distinct.</li>
<li>For type 2 queries, $x_i$ will be less than or equal to the current number of trees.</li>
<li>At any time no two trees have the exactly same heights.</li>
</ul>
<p>In each line integers are separated by single spaces.</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>Print $m$ integers – the length of the longest increasing subsequence after each query. Separate the numbers by whitespaces.</p>
<span id="more"></span>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p><strong>Input</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">4 6</span><br><span class="line">1 1 1</span><br><span class="line">1 4 4</span><br><span class="line">1 3 4</span><br><span class="line">2 2</span><br><span class="line">1 2 8</span><br><span class="line">2 3</span><br></pre></td></tr></table></figure>
<p><strong>Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>标签：<code>线段树</code></p>
<h2 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h2><p>有一条有$n$ $(n\le10^5)$个位置的路，现有$m$ $(m\le 2\cdot10^5)$个操作，分为两种：</p>
<ol>
<li>在第$p$ $(p\le n)$个位置种下一棵高度为$h$ $(1\le h\le 10)$的树</li>
<li>砍掉从左向右第$x$ $(1\le x\le10)$棵树</li>
</ol>
<p>每个单位时间内，树会长高$1$米。<br>每次操作后，输出当前最长上升子序列的长度。<br>数据保证任意时刻没有两棵树高度相同。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>由于$n$比较大，显然不能用二维树状数组&#x2F;线段树维护$\mathrm{DP}$。</p>
<p>考虑最长上升子序列如何$\mathrm{DP}$。从后往前$\mathrm{DP}$，每次找到后面的数值比当前大的位置，选出其中$\mathrm{DP}$值最大的加$1$，作为当前位置的$\mathrm{DP}$值。找后面符合条件的最大$\mathrm{DP}$值可以用线段树维护。如果将位置和数值作为$x,y$值放到坐标系上，发现如果将$x,y$值对换后，问题是完全相同的。于是可以得到另一种$\mathrm{DP}$方法：从数值最大的向数值最小的$\mathrm{DP}$，每次找到比其大的数值中对应位置在其后面的数对应的$\mathrm{DP}$值的最大值，将最大值加$1$作为当前数的$\mathrm{DP}$值。同样地，这种方法也可以用线段树维护。</p>
<p>观察题目中的特殊条件，发现$h,x$均不大于$10$。如果插入一棵高度为$h$的树，则需要将所有高度小于$h$的树的$\mathrm{DP}$值重新计算；如果砍掉第$x$棵树，则需要将第$1\sim (x-1)$棵树的$\mathrm{DP}$值重新计算。每次重新计算的位置均不大于$10$个。</p>
<p>考虑维护两棵线段树，分别对应前面的两种$\mathrm{DP}$方式（第一棵按$x$从大到小算，第二棵按$y$从大到小算）。种树时，找出所有高度小于$h$的位置，将第一棵线段树中对应位置的$\mathrm{DP}$值清零，按高度从大到小排序，然后依次计算$\mathrm{DP}$值，由于$\mathrm{DP}$到每个位置时，比它高的树都已经被$\mathrm{DP}$过了，所以可以保证正确性。砍树时，找出第$1\sim(x-1)$棵树，将第二棵线段树中对应高度的$\mathrm{DP}$值清零，从后向前依次计算$\mathrm{DP}$值，正确性同样可以保证。注意修改$\mathrm{DP}$值时在两棵线段树上都需要修改。<br>为了快速找到前$(x-1)$棵树，可以维护一个堆，存储当前有树的位置，每次弹出前$(x-1)$小即可。</p>
<p>总时间复杂度$O(10\times n\log{n})$。</p>
<p>附上官方题解</p>
<div class="pdf-container" data-target="https://files.cnblogs.com/files/AzraelDeath/CF264E.pdf" data-height="500px"></div>

<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_N 200010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mid ((s+t)&gt;&gt;1)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">	x = <span class="number">0</span>; <span class="type">int</span> c = <span class="built_in">getchar</span>(), f = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(c); c = <span class="built_in">getchar</span>()) <span class="keyword">if</span> (c == <span class="number">45</span>) f = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (; <span class="built_in">isdigit</span>(c); c = <span class="built_in">getchar</span>()) (x *= <span class="number">10</span>) += f*(c-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, m, mx, tr[<span class="number">2</span>][MAX_N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> h[MAX_N+<span class="number">5</span>], id[MAX_N+<span class="number">5</span>];</span><br><span class="line">priority_queue &lt;<span class="type">int</span>&gt; heap; stack &lt;<span class="type">int</span>&gt; sta;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> v, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s == t) &#123;tr[num][v] = x; <span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (p &lt;= mid) <span class="built_in">modify</span>(num, v&lt;&lt;<span class="number">1</span>, s, mid, p, x);</span><br><span class="line">	<span class="keyword">if</span> (p &gt;= mid+<span class="number">1</span>) <span class="built_in">modify</span>(num, v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, p, x);</span><br><span class="line">	tr[num][v] = <span class="built_in">max</span>(tr[num][v&lt;&lt;<span class="number">1</span>], tr[num][v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> v, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) <span class="keyword">return</span> tr[num][v]; <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid) ret = <span class="built_in">max</span>(ret, <span class="built_in">query</span>(num, v&lt;&lt;<span class="number">1</span>, s, mid, l, r));</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) ret = <span class="built_in">max</span>(ret, <span class="built_in">query</span>(num, v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r));</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">read</span>(n), <span class="built_in">read</span>(m), mx = m+<span class="number">10</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> now = <span class="number">1</span>; now &lt;= m; now++) &#123;</span><br><span class="line">		<span class="type">int</span> opt, p, x; <span class="built_in">read</span>(opt), <span class="built_in">read</span>(p);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">read</span>(x), x = x-now+m;</span><br><span class="line">			h[p] = x, id[x] = p, heap.<span class="built_in">push</span>(-p);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>-now+m; i &lt; x; i++)</span><br><span class="line">				<span class="keyword">if</span> (id[i]) <span class="built_in">modify</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, mx, id[i], <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = x, c; i &gt;= <span class="number">1</span>-now+m; i--) <span class="keyword">if</span> (id[i])</span><br><span class="line">				c = <span class="built_in">query</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, mx, id[i], mx)+<span class="number">1</span>, </span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, mx, id[i], c), </span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, mx, i, c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; p; i++)</span><br><span class="line">				sta.<span class="built_in">push</span>(-heap.<span class="built_in">top</span>()), heap.<span class="built_in">pop</span>(), </span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, mx, h[sta.<span class="built_in">top</span>()], <span class="number">0</span>);</span><br><span class="line">			p = -heap.<span class="built_in">top</span>(), heap.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, mx, p, <span class="number">0</span>);</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, mx, h[p], <span class="number">0</span>);</span><br><span class="line">			id[h[p]] = <span class="number">0</span>, h[p] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i, c; !sta.<span class="built_in">empty</span>(); )</span><br><span class="line">				i = sta.<span class="built_in">top</span>(), </span><br><span class="line">				c = <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, mx, h[i], mx)+<span class="number">1</span>, </span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, mx, i, c), </span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, mx, h[i], c), </span><br><span class="line">				heap.<span class="built_in">push</span>(-sta.<span class="built_in">top</span>()), sta.<span class="built_in">pop</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, tr[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/OI-Blog/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag"># 线段树</a>
              <a href="/OI-Blog/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag"># 数据结构</a>
              <a href="/OI-Blog/tags/CodeForces/" rel="tag"># CodeForces</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/OI-Blog/2018/09/27/BZOJ1415%E3%80%90NOI2005%E3%80%91%E8%81%AA%E8%81%AA%E5%92%8C%E5%8F%AF%E5%8F%AF%20%E6%A6%82%E7%8E%87DP+%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="prev" title="BZOJ1415【NOI2005】聪聪和可可 <概率DP+最短路>">
                  <i class="fa fa-chevron-left"></i> BZOJ1415【NOI2005】聪聪和可可 <概率DP+最短路>
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/OI-Blog/2018/10/01/BZOJ4872%E3%80%90SHOI2017%E3%80%91%E5%88%86%E6%89%8B%E6%98%AF%E7%A5%9D%E6%84%BF%20%E6%A6%82%E7%8E%87DP/" rel="next" title="BZOJ4872【SHOI2017】分手是祝愿 <概率DP>">
                  BZOJ4872【SHOI2017】分手是祝愿 <概率DP> <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Azrael</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/OI-Blog/js/comments.js"></script><script src="/OI-Blog/js/utils.js"></script><script src="/OI-Blog/js/motion.js"></script><script src="/OI-Blog/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/OI-Blog/lib/pdf/web/viewer.html"}</script>
  <script src="/OI-Blog/js/third-party/tags/pdf.js"></script>


  <script src="/OI-Blog/js/third-party/fancybox.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/OI-Blog/js/third-party/math/mathjax.js"></script>



</body>
</html>
